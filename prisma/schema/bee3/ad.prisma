enum AdTiers {
    Free
    Pro
    Expert
}

model Category {
    id               Int        @id
    path             String     @unique
    parentCategory   Category?  @relation("CategoryToCategory", fields: [parentCategoryId], references: [path], onDelete: NoAction, onUpdate: NoAction)
    parentCategoryId String?
    productCategory  Category[] @relation("CategoryToCategory")

    name_en     String  @unique
    name_ar     String  @unique
    description String? @db.Text
    depth       Int
    Ads         Ad[]
}

model Ad {
    id           String    @id
    userId       String?
    createdAt    DateTime  @default(now())
    updatedAt    DateTime  @updatedAt
    user         User?     @relation(fields: [userId], references: [id])
    favoritedBy  User[]    @relation("favoriteAds")
    category     Category? @relation(fields: [categoryPath], references: [path])
    categoryPath String

    tier        AdTiers @default(Free)
    title       String
    description String? @db.Text
    images      Image[]
    price       Float
    negotiable  Boolean

    city   City @relation(fields: [cityId], references: [id])
    cityId Int

    governorate   Governorate @relation(fields: [governorateId], references: [id])
    governorateId Int

    analytics     AdAnalytics @relation(fields: [adAnalyticsId], references: [id])
    adAnalyticsId String
}

model AdTokenStore {
    id     String @id @default(cuid())
    userId String
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    tokenType       AdTiers
    initialCount    Int
    count           Int
    nextRefreshTime DateTime
    refreshInDays   Int

    @@unique([userId, tokenType])
}

model AdAnalytics {
    id String @id @default(cuid())
    Ad Ad[]

    views       Int
    uniqueViews Int
}
